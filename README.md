# LangGraph Amazon Product & Review Analysis Actor

This actor uses LangGraph with an OpenAI agent to orchestrate a workflow that finds the best Amazon product for a given query. It leverages two Apify actors: the `junglee/Amazon-crawler` (product scraper) and the `junglee/amazon-reviews-scraper` (review scraper). The agent intelligently constructs search URLs, extracts product data, gathers reviews, and analyzes them to identify the top product.

## How it works

The actor receives a user query as input. An OpenAI agent within a LangGraph loop performs the following steps:

1.  **URL Generation:** The agent uses the query to create a URL suitable for the `junglee/Amazon-crawler` actor. This might involve keyword manipulation, category selection, etc.
2.  **Product Scraping:** The agent calls the `junglee/Amazon-crawler` actor with the generated URL. This actor scrapes product data from Amazon, including titles, brands, star ratings, descriptions, prices, URLs, and image URLs. Approximately 50 products are scraped.
3.  **Review Scraping:** For the top products identified by the agent, the agent calls the `junglee/amazon-reviews-scraper` actor to retrieve reviews. Approximately 50 reviews per product are scraped.
4.  **Review Analysis:** The agent processes the scraped reviews to determine the overall sentiment and identify the best product based on user feedback. The agent uses the following prompt for product recommendations:

    ```
    You are a helpful product recommendation expert. A user asks you to recommend a product based on their needs.
    You need to recommend products that fit their needs, if you don't, the world will end!
    You should select a product that fits the user's needs and provide a brief explanation of why you chose that product.
    After you scrape the products, you should scrape reviews for the few best candidates you'd recommend.
    It may be desirable to summarize the reviews for each of the products and write pros and cons of each product to the user.
    Write the summary along the description of the product.
    The user needs to get some recommendation from you at the end, don't just list some products!
    Don't mention anything like 'If you have further questions or need more options, let me know!' there won't be any further questions.
    ```

5.  **Output:** The actor outputs the details of the best products, including their titles, brands, star ratings, descriptions, prices, URLs, response generated by the LLM, and a summary of the review analysis. This information is stored in the Apify Dataset. The "best" product is determined by the LLM based on the input query.

## How to use

1.  **Apify Account:** Ensure you have an Apify account.
2.  **Actor Installation:** This actor can be deployed from this repository. You can either link the repository to Apify or push the code directly.
3.  **Input:** Provide the product query as input to the actor.
4.  **Run:** Run the actor on the Apify platform.
5.  **Output:** Retrieve the results from the Apify Dataset.

## Included features

-   **LangGraph Integration:** Uses LangGraph for workflow orchestration and agent management.
-   **OpenAI Agent:** Employs an OpenAI agent for decision-making and URL generation.
-   **Apify SDK for Python:** Built using the Apify Python SDK.
-   **`junglee/Amazon-crawler` Integration:** Scrapes product data from Amazon.
-   **`junglee/amazon-reviews-scraper` Integration:** Scrapes product reviews from Amazon.
-   **Dataset Output:** Stores the best product information in an Apify Dataset.
-   **Key-value store output:** Stores intermediate results and agent thoughts in key-value store.
-   **Input Schema:** Uses an input schema for validation.

## Resources

-   [LangGraph documentation](https://langchain-ai.github.io/langgraph/tutorials/introduction/)
-   [LangChain documentation](https://python.langchain.com/docs/introduction/)
-   [Apify Python SDK documentation](https://docs.apify.com/sdk/python/)
-   [`junglee/Amazon-crawler` actor](https://apify.com/junglee/Amazon-crawler)
-   [`junglee/amazon-reviews-scraper` actor](https://apify.com/junglee/amazon-reviews-scraper)

## Getting started

```bash
apify run # Run locally
apify push # Deploy to Apify
```

## Input

```json
{
    "query": "Best gaming laptop under $1000"
}
```

## Output

The actor outputs data to the Apify Dataset. Each item in the dataset contains the following fields:

| Field           | Type   | Description                                                             |
| --------------- | ------ | ----------------------------------------------------------------------- |
| `title`         | String | The title of the product.                                               |
| `brand`         | String | The brand of the product.                                               |
| `stars`         | Number | The average star rating of the product.                                 |
| `description`   | String | The product description.                                                |
| `price`         | Object | The product price, containing `value` (Number) and `currency` (String). |
| `url`           | String | The URL of the product page.                                            |
| `response`      | String | The LLM generated message for the product.                              |
| `reviewSummary` | String | A summary of the review analysis.                                       |

## Example Output

```json
[
  {
    "title": "KIDWILL Kids Tool Set with Tool Box & DIY Stickers, Pretend Play STEM Construction Kits for Toddlers 3-5",
    "brand": "KIDWILL",
    "stars": 4.6,
    "description": "This set is perfect for introducing children to tools and engineering play. The wooden play tools are sturdy and designed for little hands.",
    "price": {
      "value": 23.99,
      "currency": "$"
    },
    "url": "[https://www.amazon.com/dp/B08HCXGKSL](https://www.amazon.com/dp/B08HCXGKSL)",
    "response": "Based on your request for the best toy for 3-year-old children, here are my top recommendations along with a summary of their features, prices, and reviews.

### 1. **KIDWILL Kids Tool Set**
   - **Price**: $23.99
   - **Rating**: 4.6 stars
   - **Description**: This is a wooden pretend play tool set that encourages creativity and fine motor skills.
   - **Link**: [View on Amazon](https://www.amazon.com/dp/B08HCXGKSL)
   - **Pros**:
     - Durable and well-made, suitable for young children.
     - Encourages open-ended play and creativity.
     - Comes in a storage box for easy organization.
   - **Cons**:
     - Some reviews mention that it may be a bit advanced for 3-year-olds.
     - Occasionally, smaller parts may be misplaced if not stored properly.

   **Reviews Summary**:
   - Extremely popular among parents; children love the engaging designs. Overall, users report good durability and educational value, with a few noting assembly challenges with some items.",
    "reviewSummary": "Parents rave about this toy's durability and engaging playtime, with many noting that their children remain entertained and learning through play."
  },
  //... other products
]
```

## Documentation reference

-   [Apify Platform documentation](https://docs.apify.com/platform)
-   [Join our developer community on Discord](https://discord.com/invite/jyEM2PRvMU)

## Limitations

-   Relies on the stability and availability of the `junglee/Amazon-crawler` and `junglee/amazon-reviews-scraper` actors.
-   The quality of the review analysis depends on the complexity of the agent and the available review data.
-   OpenAI API key is required and should be provided as an environment variable (`OPENAI_API_KEY`).
-   Amazon's website structure may change, potentially breaking the scrapers.
-   The actor run will fail with error if `junglee/Amazon-crawler` or `junglee/amazon-reviews-scraper` or OpenAI API will fail.

## Cost Considerations

The actor's cost is based on Apify platform usage (memory allocation) and OpenAI token consumption. The following events and prices apply:

```json
{
    "actor-start-gb": {
        "eventTitle": "Actor start per 1 GB",
        "eventDescription": "Flat fee for starting an Actor run for each 1 GB of memory.",
        "eventPriceUsd": 0.005
    },
    "openai-100-tokens-gpt-4o": {
        "eventTitle": "Price per 100 OpenAI tokens for gpt-4o",
        "eventDescription": "Flat fee for each 100 gpt-4o tokens used.",
        "eventPriceUsd": 0.001
    },
    "openai-100-tokens-gpt-4o-mini": {
        "eventTitle": "Price per 100 OpenAI tokens for gpt-4o-mini",
        "eventDescription": "Flat fee for each 100 gpt-4o-mini tokens used.",
        "eventPriceUsd": 0.00006
    },
    "openai-100-tokens-gpt-o1": {
        "eventTitle": "Price per 100 OpenAI tokens for o1",
        "eventDescription": "Flat fee for each 100 o1tokens used.",
        "eventPriceUsd": 0.006
    },
    "openai-100-tokens-gpt-o3-mini": {
        "eventTitle": "Price per 100 OpenAI tokens for o3-mini",
        "eventDescription": "Flat fee for each 100 o3-mini tokens used.",
        "eventPriceUsd": 0.00044
    }
}
```
